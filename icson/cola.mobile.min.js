var cola={};var domain=location.protocol+"//"+location.host+"/"+(/weixin\.yixun\.com/.test(location.host.toString())?"coladev":"cola");var timeFlag=1;var COOKIE_N_PRDID="cola_prdid";var COOKIE_N_ADRID="cola_addrid";var codeMapping={"10002":"您还没有预约秒杀资格","20002":"可乐币扣除失败，请检查余额是否足够","110":"该瓶盖码已被使用过"};cola.initTimer=function(b){var a=this;cola.getLeaveTime(function(e){if(e.data<0){timeFlag=-1;console.log(timeFlag)}var c=Math.abs(e.data);var d=setInterval(function(){c--;a._showTimer(c);if(c<=0){clearInterval(d)}},1000)});this._showTimer=function(d){var h="00";var g="00";var c="00";if(d>0){h=d%60;if(h<10){h="0"+h}g=Math.floor((d%3600)/60);if(g<10){g="0"+g}c=Math.floor(d/3600);if(c<10){c="0"+c}}if(typeof b=="function"){var f={flag:timeFlag,hour:c,minute:g,seconds:h};b(f)}else{var e="距离秒杀"+(timeFlag>0?"开始":"结束")+":"+c+"时"+g+"分"+h+"秒";$("#timer").text(e)}}};cola.InitGift=function(){this._getGiftList=function(){};this._bindEvent=function(){};this._exchangeGift=function(){var a=domain+"/exchange/trade?";var b={product:prdId};$.getJSON(a,b,function(c){})}};cola.initSk=function(){var a=this;this.getSkList=function(){var b=domain+"/seckillquery?callback=?&date=20131213";$.getJSON(b,function(d){if(d.errno==0){var e=d.data;for(var c in e){a._getPrdInfo(e[c].idx,e[c].activeid,e[c].pid)}}else{alert("data loaded error!")}})};this._getPrdInfo=function(b,f,e){var c=this;var d="http://d.qiang.yixun.com/qiangitem/GetDetail?&activeid="+f+"&itemId="+e+"&_time="+Math.random();$.getScript(d,function(){if(pageInfo.errCode===0){var i={};var h=pageInfo.itemInfo;i.prdId=e;i.actId=f;i.title=h.title;var g=h.p_char_id.match(/^(\d+)\-(\d+)\-(\d+)$/);i.pic="http://img1.icson.com/product/pic200/"+g[1]+"/"+g[2]+"/"+h.p_char_id+".jpg";i.url=h.originItemUrl;i.stock=h.stock;i.stockAll=h.stockAll;i.price=h.qiangPrice;c._showProduct(b,i)}})};this._showProduct=function(b,e){var f="sk_"+b+"_bt";var d=[];d.push("<ul>");d.push('<li class="prd_img"><img src="'+e.pic+'" width=160 height=160 /></li>');d.push('<li class="prd_desc">');d.push("	<h5>商品名称："+e.title+"</h5>");d.push("	<h5>价格：&yen;"+e.price+"</h5>");d.push("	<h5>库存：</h5>");if(timeFlag>0){d.push("<span>15点开抢</span>")}else{d.push('<span><a id="'+f+'" href="javascript:;">立即秒杀</a></span>')}d.push("</li>");d.push("</ul>");$("div.prd_item").eq(b).html(d.join(""));var c=this;$("#"+f).click(function(){if(timeFlag>0){alert("请耐心等待，秒杀将于今日15:00准时开始哦!");return false}var g="seckillorder?prdId="+e.prdId;c._doSk(e.prdId,g);return false})};this._doSk=function(c,b){if(cola.isLogin()){cola.checkSubscribe(function(d){if(d==0){alert("您还没有预约秒杀资格");return false}window.location=b})}};this.getSkList()};cola.initSuperBuy=function(d){var a=this;var b="";var c={dataType:"script",scriptCharset:"gbk",success:function(){if(typeof d=="function"){d(GoodsInfo_51buy.pblock[0].list)}else{console.log(GoodsInfo_51buy.pblock[0].list)}}};$.ajax("http://event.yixun.com/event/17091_info.js",c)};cola.initLottery=function(c,b){var a=this;(function(){var d=domain+"/lotteryquery?component_id=245&callback=?";$.getJSON(d,function(e){if(e.errno==0){if(typeof c=="function"){c(e.award_list);a.runLottery()}}})})();this.runLottery=function(){$("#bt_lottery").click(function(){var d=domain+"/lottery?component_id=245&verify_code=1&callback=?";$.getJSON(d,function(e){b(e)})})}};cola.getDiscountList=function(b){var a={url:"http://event.yixun.com/event/17091_info.js",dataType:"script",scriptCharset:"gbk",success:function(){if(typeof b=="function"){b.apply(this,GoodsInfo_51buy.pblock[0].list)}}};$.ajax(a)};cola.getUserAddress=function(b){var a="http://d.qiang.yixun.com/orderconfirm/getuserrecvaddress";$.getScript(a,function(){if(_addressInfo.errCode==0){if($.isFunction(b)){b(_addressInfo.data.list)}}else{alert("地址信息拉取失败")}})};cola.storePincode=function(c){var a=domain+"/colacoinadd?callback=?";var b={pincode:c};$.getJSON(a,b,function(d){if(d.errno==0){}else{console.log("error:"+d.errno)}})};cola.getPincodeCount=function(b){var a=domain+"/colacoinquery?callback=?";$.getJSON(a,function(c){if(c.errno==0){if(typeof b=="function"){b.apply(this,c.data.colacoin)}}else{console.log("error:"+c.errno)}})};cola.getProductInfo=function(b,c){var a="http://d.qiang.yixun.com/qiangitem/GetDetail?&activeid=0&itemId="+b+"&_time="+Math.random();$.getScript(a,function(){if(pageInfo.errCode===0){var f={};var e=pageInfo.itemInfo;f.prdId=b;f.title=e.title;var d=e.p_char_id.match(/^(\d+)\-(\d+)\-(\d+)$/);f.pic="http://img1.icson.com/product/pic160/"+d[1]+"/"+d[2]+"/"+e.p_char_id+".jpg";f.url=e.originItemUrl;f.stock=e.stock;f.stockAll=e.stockAll;f.price=e.qiangPrice;if($.isFunction(c)){c(f)}}})};cola.storePincode=function(c){var a=domain+"/cola/colacoinadd?callback=?";var b={pincode:c};$.getJSON(a,b,function(d){if(d.errno==0){cola.getPincodeCount()}else{alert(cola.code2error(d.errno))}})};cola.getPincodeCount=function(){var a=domain+"/cola/colacoinquery?callback=?";$.getJSON(a,function(b){if(b.errno==0){$("#pincode_count").html(b.data.colacoin)}else{console.log("get pincode errno:"+b.errno)}})};cola.getColaCoinsHistory=function(c,a,f){var e=(c-1)*a;if(e<0){e=0}var b=domain+"/colacoinhistory?callback=?";var d={offset:e};$.getJSON(b,d,function(g){if(typeof f=="function"){f(g)}})};cola.skSubscribe=function(){if(cola.isLogin()){var a=domain+"/SeckillSubscribe?callback=?";$.getJSON(a,function(b){if(b.errno==0){alert("恭喜您预约成功")}else{if(b.errno==20001){alert("您已经预约过啦")}else{alert("秒杀资格预约失败")}}})}};cola.checkSubscribe=function(b){var a=domain+"/SeckillCheck?callback=?";$.getJSON(a,function(c){c.errno=0;if(c.errno==0){if($.isFunction(b)){b(c.data)}}else{alert(cola.code2error(c.errno))}})};cola.bindQQ=function(a){var b=domain+"/bind/bind?callback=?";var c={qq:a};$.getJSON(b,c,function(d){})};cola.getLeaveTime=function(c){var a=domain+"/time";var b={url:a,type:"GET",async:false,dataType:"jsonp",jsonp:"callback",jsonpCallback:"timeCallback",success:function(d){if(d.errno==0){if($.isFunction(c)){c(d)}}else{alert("time initialize failed!")}}};$.ajax(b)};cola.getCookie=function(b){var c=new RegExp("(^|;|\\s+)"+b+"=([^;]*)(;|$)");var a=document.cookie.match(c);return(!a?"":unescape(a[2]))};cola.setCookie=function(b,f,g,a,e){var c=b+"="+escape(f)+"; path="+(g||"/")+(e?("; domain="+e):"");if(a>0){var h=new Date();h.setTime(h.getTime()+a*1000);c+=";expires="+h.toGMTString()}document.cookie=c};cola.isLogin=function(){var a=$.trim(cola.getCookie("uid"))===""?false:true;a=true;if(!a){alert("请您登录进行下一步操作")}return a};cola.code2error=function(a){return codeMapping[a]};cola.getParam=function(b){var c=new RegExp(b+"=([^&]*)");var a=location.href.match(c);return !a?"":a[1]};cola.listLazyLoad=function(){$("img.lazy").lazyload()};cola.doPost=function(b,e,g,f){f=f||"utf-8";cola.doPost.pIndex=(cola.doPost.pIndex||0)+1;var c=$('<iframe name="iframe_'+cola.doPost.pIndex+'" src="about:blank" style="display:none" width="0" height="0" scrolling="no" allowtransparency="true" frameborder="0"></iframe>').appendTo($(document.body));var a=[];$.each(e,function(i,h){a.push('<input type="hidden" name="'+i+'" value="'+h+'"/>')});var d=$('<form method="post" action="'+b+'" accept-charset="'+f+'" target="iframe_'+cola.doPost.pIndex+'">'+a.join("")+"</form>").appendTo($(document.body));c[0].callback=function(h){if(typeof g=="function"){g(h)}$(this).src="about:blank";d.remove();$(this).remove();c=d=null};d.submit()};cola.checkPincode=function(b){var a=new RegExp("^[a-zA-Z0-9]{13}$");return a.test(b)};